<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container">
    <div class="position-relative mx-auto d-flex flex-column" style="width:435px;height:865px;background:no-repeat center / cover url('/img/iphonese.png')">
      <div class="position-absolute" style="width:375px;height:667px;top:11.5%;left:7%;background-color:rgba(255,255,255,1)" >
        <div>
          <div class="table-responsive">
            <h5 class="text-center">2020年10月</h5>
            <table class="table table-bordered" style="table-layout:fixed;">
              <tr>
                <th class="text-center">月</th>
                <th class="text-center">火</th>
                <th class="text-center">水</th>
                <th class="text-center">木</th>
                <th class="text-center">金</th>
                <th class="text-center">土</th>
                <th class="text-center">日</th>
              </tr>
              <tr>
                <td data-calendar-position-1 class="text-center" style="font-size:16px;"><p data-calendar-position-day-1 class="m-0">1</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-2 class="text-center" style="font-size:16px;"><p data-calendar-position-day-2 class="m-0">2</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-3 class="text-center" style="font-size:16px;"><p data-calendar-position-day-3 class="m-0">3</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-4 class="text-center" style="font-size:16px;"><p data-calendar-position-day-4 class="m-0">4</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-5 class="text-center" style="font-size:16px;"><p data-calendar-position-day-5 class="m-0">5</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-6 class="text-center" style="font-size:16px;"><p data-calendar-position-day-6 class="m-0">6</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-7 class="text-center" style="font-size:16px;"><p data-calendar-position-day-7 class="m-0">7</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
              </tr>
              <tr>
                <td data-calendar-position-8 class="text-center" style="font-size:16px;"><p data-calendar-position-day-8 class="m-0">8</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-9 class="text-center" style="font-size:16px;"><p data-calendar-position-day-9 class="m-0">9</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-10 class="text-center" style="font-size:16px;"><p data-calendar-position-day-10 class="m-0">10</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-11 class="text-center" style="font-size:16px;"><p data-calendar-position-day-11 class="m-0">11</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-12 class="text-center" style="font-size:16px;"><p data-calendar-position-day-12 class="m-0">12</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-13 class="text-center" style="font-size:16px;"><p data-calendar-position-day-13 class="m-0">13</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-14 class="text-center" style="font-size:16px;"><p data-calendar-position-day-14 class="m-0">14</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
              </tr>
              <tr>
                <td data-calendar-position-15 class="text-center" style="font-size:16px;"><p data-calendar-position-day-15 class="m-0">15</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-16 class="text-center" style="font-size:16px;"><p data-calendar-position-day-16 class="m-0">16</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-17 class="text-center" style="font-size:16px;"><p data-calendar-position-day-17 class="m-0">17</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-18 class="text-center" style="font-size:16px;"><p data-calendar-position-day-18 class="m-0">18</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-19 class="text-center" style="font-size:16px;"><p data-calendar-position-day-19 class="m-0">19</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-20 class="text-center" style="font-size:16px;"><p data-calendar-position-day-20 class="m-0">20</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-21 class="text-center" style="font-size:16px;"><p data-calendar-position-day-21 class="m-0">21</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
              </tr>
              <tr>
                <td data-calendar-position-22 class="text-center" style="font-size:16px;"><p data-calendar-position-day-22 class="m-0">22</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-23 class="text-center" style="font-size:16px;"><p data-calendar-position-day-23 class="m-0">23</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-24 class="text-center" style="font-size:16px;"><p data-calendar-position-day-24 class="m-0">24</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-25 class="text-center" style="font-size:16px;"><p data-calendar-position-day-25 class="m-0">25</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-26 class="text-center" style="font-size:16px;"><p data-calendar-position-day-26 class="m-0">26</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-27 class="text-center" style="font-size:16px;"><p data-calendar-position-day-27 class="m-0">27</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-28 class="text-center" style="font-size:16px;"><p data-calendar-position-day-28 class="m-0">28</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
              </tr>
              <tr>
                <td data-calendar-position-29 class="text-center" style="font-size:16px;"><p data-calendar-position-day-29 class="m-0">29</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-30 class="text-center" style="font-size:16px;"><p data-calendar-position-day-30 class="m-0">30</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-31 class="text-center" style="font-size:16px;"><p data-calendar-position-day-31 class="m-0">31</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-32 class="text-center" style="font-size:16px;"><p data-calendar-position-day-32 class="m-0">32</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-33 class="text-center" style="font-size:16px;"><p data-calendar-position-day-33 class="m-0">33</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-34 class="text-center" style="font-size:16px;"><p data-calendar-position-day-34 class="m-0">34</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-35 class="text-center" style="font-size:16px;"><p data-calendar-position-day-35 class="m-0">35</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
              </tr>
              <tr>
                <td data-calendar-position-36 class="text-center" style="font-size:16px;"><p data-calendar-position-day-36 class="m-0">36</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-37 class="text-center" style="font-size:16px;"><p data-calendar-position-day-37 class="m-0">37</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-38 class="text-center" style="font-size:16px;"><p data-calendar-position-day-38 class="m-0">38</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-39 class="text-center" style="font-size:16px;"><p data-calendar-position-day-39 class="m-0">39</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-40 class="text-center" style="font-size:16px;"><p data-calendar-position-day-40 class="m-0">40</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-41 class="text-center" style="font-size:16px;"><p data-calendar-position-day-41 class="m-0">41</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
                <td data-calendar-position-42 class="text-center" style="font-size:16px;"><p data-calendar-position-day-42 class="m-0">42</p><p class="m-0">09:30</p><p class="m-0" style="font-size:8px;line-height:8px">|</p><p class="m-0">18:00</p></td>
              </tr>
              
            </table>
          </div>

          <div class="table-responsive">
            <table id="result_table" class="table table-bordered" style="table-layout:fixed;">
            <thead id="result_thead"></thead>
            <tbody id="result_tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <!-- <div class="table-responsive">
  <table id="result_table" class="table table-bordered" style="table-layout:fixed;">
  <thead id="result_thead"></thead>
  <tbody id="result_tbody"></tbody>
  </table>
  </div> -->

  
  <!-- <button onClick='post()'>"1","2020-09-05","09:00:00","18:00:00"</button> -->
  <!-- <form action="/posttest.php" method="post">
    <input type="text" name="userid" value="1">
    <input type="text" name="date" value="2020-09-05">
    <input type="text" name="start_time" value="09:00:00">
    <input type="text" name="end_time" value="18:00:00">
    <input type="submit" value="送信">
  </form> -->
</div>
  <?php
    // phpinfo();
    
    $dsn = 'mysql:host=mysql;dbname=schedule';
    $user = 'root';
    $password = 'root';

    // try {
    //   # hostには「docker-compose.yml」で指定したコンテナ名を記載
    //   $db = new PDO($dsn, 'root', 'root');

    //   $sql = "SELECT * FROM work_time";
    //   $stmt = $db->prepare($sql);
    //   $stmt->execute();
    //   $result = $stmt->fetchAll(PDO::FETCH_ASSOC);
    //   var_dump($result);
    // } catch (PDOException $e) {
    //     echo $e->getMessage();
    //     exit;
    // }
    
    try{
      $dbh = new PDO($dsn, $user, $password);
      $dbh->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
      // echo "接続成功";
      
      $sql = 'SELECT * FROM work_time';
      $statement = $dbh -> query($sql);
      $work_time_array = $statement -> fetchAll(PDO::FETCH_NUM);

      $sql = 'SELECT * FROM users';
      $statement = $dbh -> query($sql);
      $user_list_array = $statement -> fetchAll(PDO::FETCH_NUM);

      // //レコード件数取得
      // $row_count = $statement->rowCount();
      
      // while($row = $statement->fetch()){
      //   $rows[] = $row;
      // }
      
      // foreach ($statement as $row) {
      //   $rows[] = $row;
      // }
      
      
      //データベース接続切断
      $dbh = null;
        
    }catch (PDOException $e){
      print('Error:'.$e->getMessage());
      die();
    }
  ?>
<hr>

  <div class=container>
  <h4>デバッグ情報</h4>
    <h5>post結果</h5>
    <div id="post_result">...</div>
  </div>
<div class="container">
<h5>DB_users</h5>
<table id="users_db" class="table table-bordered">
  <thead>
    <tr>
      <th>userid</th><th>name</th><th>pw</th><th>created</th><th>isdelete</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<h5>DB_work_time</h5>
<table id="work_time_db" class="table table-bordered">
  <thead>
    <tr>
      <th>id</th><th>userid</th><th>date</th><th>start_time</th><th>end_time</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="modalBody" class="modal-body">
        ...
      </div>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div> -->
    </div>
  </div>
</div>


<script>
let user_list = [];
let raw_user_list = (<?= json_encode($user_list_array) ?>);
raw_user_list.forEach(e => {
  user_list.push([e[0],e[1]]);
});
let work_time_list = [];
let raw_work_time_list = (<?= json_encode($work_time_array) ?>);
raw_work_time_list.forEach(e => {
  work_time_list.push([e[1],e[2],e[3],e[4]]);
});
console.log(work_time_list);

</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
<script src="/js/script.js"></script>
<script>
  // let post_data = {userid: "1", date:"2020-09-05", start_time:"09:00:00",end_time:"18:00:00"}
  function post(post_data = "userid="+document.getElementById("post_userid").value+"&date="+document.getElementById("post_date").value+"&start_time="+document.getElementById("post_start_time").value+"&end_time="+document.getElementById("post_end_time").value) {
    console.log(post_data);
    //let post_data = "userid=1&date=2020-09-05&start_time=09:00:00&end_time=18:00:00"
    var XHR = new XMLHttpRequest();
    XHR.open("POST", "/post.php", true);
    // XHR.open("POST", "/posttest.php", true);
    XHR.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded;charset=UTF-8' );
    XHR.send(post_data);
    XHR.onreadystatechange = function(){
      if(XHR.readyState == 4 && XHR.status == 200){
        console.log("XHR OK");
        document.getElementById("post_result").innerHTML = XHR.responseText;
        console.log(XHR.responseText);
        const raw_res_status = XHR.responseText;
        const res_status = JSON.parse(raw_res_status);
        if (res_status.state === "OK") {
          console.log("OK");
          calendar_data = addCalendar(res_status,calendar_data);
        }else{
          console.log("NG");
        }
      }
    };
  }

</script>
</body>
</html>